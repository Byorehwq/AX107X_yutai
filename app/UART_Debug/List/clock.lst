##############################################################################
#                                                                            #
# IAR 8051 C/C++ Compiler V7.20H/W32                   10/Sep/2015  19:03:27 #
# Copyright 2004-2006 IAR Systems. All rights reserved.                      #
#                                                                            #
#    Core               =  plain                                             #
#    Code model         =  near                                              #
#    Data model         =  large                                             #
#    Calling convention =  extended stack reentrant                          #
#    Constant location  =  code                                              #
#    Extended stack     =  enabled                                           #
#    Dptr setup         =  1,16                                              #
#    Source file        =  C:\Documents and Settings\Administrator\×ÀÃæ\lily #
#                          \15BC178B_Lily_AX1070_20150908\15BC178B_Lily_AX10 #
#                          70_20150908\module\clock.c                        #
#    Command line       =  -I "C:\Program Files\IAR Systems\Embedded         #
#                          Workbench 4.05 Evaluation version\8051\INC\" -I   #
#                          "C:\Program Files\IAR Systems\Embedded Workbench  #
#                          4.05 Evaluation version\8051\INC\CLIB\" -I        #
#                          "C:\Documents and Settings\Administrator\×ÀÃæ\lil #
#                          y\15BC178B_Lily_AX1070_20150908\15BC178B_Lily_AX1 #
#                          070_20150908\COMMON\" -I "C:\Documents and        #
#                          Settings\Administrator\×ÀÃæ\lily\15BC178B_Lily_AX #
#                          1070_20150908\15BC178B_Lily_AX1070_20150908\INC\" #
#                           -I "C:\Documents and Settings\Administrator\×ÀÃæ #
#                          \lily\15BC178B_Lily_AX1070_20150908\15BC178B_Lily #
#                          _AX1070_20150908\config\" -I "C:\Documents and    #
#                          Settings\Administrator\×ÀÃæ\lily\15BC178B_Lily_AX #
#                          1070_20150908\15BC178B_Lily_AX1070_20150908\api\" #
#                           -I "C:\Documents and Settings\Administrator\×ÀÃæ #
#                          \lily\15BC178B_Lily_AX1070_20150908\15BC178B_Lily #
#                          _AX1070_20150908\fm\" -I "C:\Documents and        #
#                          Settings\Administrator\×ÀÃæ\lily\15BC178B_Lily_AX #
#                          1070_20150908\15BC178B_Lily_AX1070_20150908\fat\" #
#                           -I "C:\Documents and Settings\Administrator\×ÀÃæ #
#                          \lily\15BC178B_Lily_AX1070_20150908\15BC178B_Lily #
#                          _AX1070_20150908\display\" -I "C:\Documents and   #
#                          Settings\Administrator\×ÀÃæ\lily\15BC178B_Lily_AX #
#                          1070_20150908\15BC178B_Lily_AX1070_20150908\displ #
#                          ay\led\" -I "C:\Documents and                     #
#                          Settings\Administrator\×ÀÃæ\lily\15BC178B_Lily_AX #
#                          1070_20150908\15BC178B_Lily_AX1070_20150908\displ #
#                          ay\lcd\" -I "C:\Documents and                     #
#                          Settings\Administrator\×ÀÃæ\lily\15BC178B_Lily_AX #
#                          1070_20150908\15BC178B_Lily_AX1070_20150908\task\ #
#                          " -I "C:\Documents and Settings\Administrator\×ÀÃ #
#                          æ\lily\15BC178B_Lily_AX1070_20150908\15BC178B_Lil #
#                          y_AX1070_20150908\user\" -I "C:\Documents and     #
#                          Settings\Administrator\×ÀÃæ\lily\15BC178B_Lily_AX #
#                          1070_20150908\15BC178B_Lily_AX1070_20150908\mem\" #
#                           -I "C:\Documents and Settings\Administrator\×ÀÃæ #
#                          \lily\15BC178B_Lily_AX1070_20150908\15BC178B_Lily #
#                          _AX1070_20150908\module\" -I "C:\Documents and    #
#                          Settings\Administrator\×ÀÃæ\lily\15BC178B_Lily_AX #
#                          1070_20150908\15BC178B_Lily_AX1070_20150908\modul #
#                          e\kedir\" -I "C:\Documents and                    #
#                          Settings\Administrator\×ÀÃæ\lily\15BC178B_Lily_AX #
#                          1070_20150908\15BC178B_Lily_AX1070_20150908\key\" #
#                           -I "C:\Documents and Settings\Administrator\×ÀÃæ #
#                          \lily\15BC178B_Lily_AX1070_20150908\15BC178B_Lily #
#                          _AX1070_20150908\startmusic\" -D UART_DEBUG -D    #
#                          AX207X_TAG -lC "C:\Documents and                  #
#                          Settings\Administrator\×ÀÃæ\lily\15BC178B_Lily_AX #
#                          1070_20150908\15BC178B_Lily_AX1070_20150908\UART_ #
#                          Debug\List\" -o "C:\Documents and                 #
#                          Settings\Administrator\×ÀÃæ\lily\15BC178B_Lily_AX #
#                          1070_20150908\15BC178B_Lily_AX1070_20150908\UART_ #
#                          Debug\Obj\" -e -z9 --debug --core=plain           #
#                          --dptr=16,1 --data_model=large --code_model=near  #
#                          --calling_convention=ext_stack_reentrant          #
#                          --place_constants=code --nr_virtual_regs 20       #
#                          --extended_stack "C:\Documents and                #
#                          Settings\Administrator\×ÀÃæ\lily\15BC178B_Lily_AX #
#                          1070_20150908\15BC178B_Lily_AX1070_20150908\modul #
#                          e\clock.c"                                        #
#    List file          =  C:\Documents and Settings\Administrator\×ÀÃæ\lily #
#                          \15BC178B_Lily_AX1070_20150908\15BC178B_Lily_AX10 #
#                          70_20150908\UART_Debug\List\clock.lst             #
#    Object file        =  C:\Documents and Settings\Administrator\×ÀÃæ\lily #
#                          \15BC178B_Lily_AX1070_20150908\15BC178B_Lily_AX10 #
#                          70_20150908\UART_Debug\Obj\clock.r51              #
#                                                                            #
#                                                                            #
##############################################################################

C:\Documents and Settings\Administrator\×ÀÃæ\lily\15BC178B_Lily_AX1070_20150908\15BC178B_Lily_AX1070_20150908\module\clock.c
      1          /*****************************************************************************
      2           * Module    : Module
      3           * File      : clock.c
      4           * Author    : jingfa
      5           * Email     :
      6           * Function  : ÏµÍ³Ê±ÖÓµÄÏà¹ØÅäÖÃ
      7           *****************************************************************************/
      8          #include "include.h"

   \                                 In segment SFR_AN, at 0x86
   \   unsigned char volatile __sfr DPCON
   \                     DPCON:
   \   000000                DS 1

   \                                 In segment SFR_AN, at 0xa3
   \   unsigned char volatile __sfr IRTCON1
   \                     IRTCON1:
   \   000000                DS 1

   \                                 In segment SFR_AN, at 0xba
   \   unsigned char volatile __sfr P0DIR
   \                     P0DIR:
   \   000000                DS 1

   \                                 In segment SFR_AN, at 0xc2
   \   unsigned char volatile __sfr TMR2CON1
   \                     TMR2CON1:
   \   000000                DS 1

   \                                 In segment SFR_AN, at 0xc3
   \   unsigned char volatile __sfr UARTSTA
   \                     UARTSTA:
   \   000000                DS 1

   \                                 In segment SFR_AN, at 0xc4
   \   unsigned char volatile __sfr UARTCON
   \                     UARTCON:
   \   000000                DS 1

   \                                 In segment SFR_AN, at 0xc5
   \   unsigned char volatile __sfr UARTBAUD
   \                     UARTBAUD:
   \   000000                DS 1

   \                                 In segment SFR_AN, at 0xc6
   \   unsigned char volatile __sfr UARTBAUDH
   \                     UARTBAUDH:
   \   000000                DS 1

   \                                 In segment SFR_AN, at 0xcd
   \   unsigned char volatile __sfr CLKCON2
   \                     CLKCON2:
   \   000000                DS 1

   \                                 In segment SFR_AN, at 0xce
   \   unsigned char volatile __sfr CLKCON3
   \                     CLKCON3:
   \   000000                DS 1

   \                                 In segment SFR_AN, at 0xcf
   \   unsigned char volatile __sfr CLKCON4
   \                     CLKCON4:
   \   000000                DS 1

   \                                 In segment SFR_AN, at 0xe2
   \   unsigned char volatile __sfr TMR1CON1
   \                     TMR1CON1:
   \   000000                DS 1
      9          
     10          /*
     11          1¡¢rc2mÉÏµçÊ±Ê¹ÄÜ²¢¼ÆËã³öÊµ¼ÊÆ«²î£¬ÒòÎª¹¦ºÄ½ÏµÍ£¬¶øÇÒ×÷ÎªWDTÊ±ÖÓÔ´£¬ÔÚÇÐÊ±ÖÓÊ±²»¹Ø±Õ£¬
     12             ËùÒÔÇÐPLL·ÖÆµÇ°£¬¿ÉÒÔÏÈÇÐµ½rc2m£»
     13          2¡¢ÈôÊ¹ÓÃxosc£¬ÒòÎªÊ¹ÄÜÑÓÊ±½Ï³¤£¨Ô¼500ms£©£¬ÉÏµçÊ±Ê¹ÄÜÒ»´Î£¬ÇÐÊ±ÖÓÊ±²»¹Ø±Õ£»
     14          3¡¢rc10mÉÏµçÊ±ÓÃ×÷ÎªPLLÊ±ÖÓÔ´£¬³õÊ¼»¯DAC£¬È»ºó¸ù¾ÝÊ±ÖÓÑ¡Ôñ£¬¿ÉÒÔ¶¯Ì¬¿ª¹Ø£»
     15          4¡¢ÏµÍ³Ö»»áÊ¹ÓÃÒ»ÖÖxosc£¬ËùÒÔÑ¡¶¨xoscÊ±£¬¾Í°ÑÆäËûxosc¹Øµô£»
     16          */
     17          
     18          void Pllset(void);
     19          u16 cal_rc2m(void);                         //¼ÆËãrc2mÊµ¼ÊÆµÂÊ£¬ÏµÍ³Ê±ÖÓ±ØÐëÎª24M
     20          void pll_clk_x32k(void);                    //Ê¹ÓÃxosc32k×÷ÎªpllÊ±ÖÓÔ´
     21          void pll_clk_x4m(void);                     //Ê¹ÓÃxosc4m×÷ÎªpllÊ±ÖÓÔ´
     22          void pll_clk_x12m(void);                    //Ê¹ÓÃxosc12m×÷ÎªpllÊ±ÖÓÔ´
     23          void pll_clk_x24m(void);                    //Ê¹ÓÃxosc24m×÷ÎªpllÊ±ÖÓÔ´
     24          void pll_clk_rc10m(void);                   //Ê¹ÓÃrc12m×÷ÎªpllÊ±ÖÓÔ´
     25          void sys_clk_pll(u8 sys_div);               //Ê¹ÓÃpll×÷ÎªÏµÍ³Ê±ÖÓ
     26          void pll_clk_rc10m_sram(u8 pll_intl,u8 pll_fracl,u8 pll_frach);
     27          

   \                                 In segment CODE_C, align 1
     28          IAR_CONST u8 pll_v_s[] = {0, 1, 1, 2};
   \                     pll_v_s:
   \   000000   00010102     DB 0, 1, 1, 2
     29          
     30          //Êä³öÏµÍ³Ê±ÖÓ
     31          #pragma location="CLK_SEG"

   \                                 In segment CLK_SEG, align 1, keep-with-next
     32          void sysclk_output(void)
   \                     sysclk_output:
     33          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
     34          	CLKCON3 |= BIT(7);
   \   000000   43CE80       ORL     0xce,#0x80
     35          	CLKCON3 &= ~BIT(6);
   \   000003   53CEBF       ANL     0xce,#0xbf
     36          	AIPCON8 |= (1<<1) | (1<<0);
   \   000006   903058       MOV     DPTR,#0x3058
   \   000009   E0           MOVX    A,@DPTR
   \   00000A   4403         ORL     A,#0x3
   \   00000C   F0           MOVX    @DPTR,A
     37          	AIPCON8 &= ~(1<<3);
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   C2E3         CLR     0xE0 /* A   */.3
   \   000010   80..         SJMP    ??Subroutine0_0
     38          	P0DIR &= ~(1<<6);
     39          }

   \                                 In segment CLK_SEG, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   903058       MOV     DPTR,#0x3058
   \   000003   E0           MOVX    A,@DPTR
   \   000004   4403         ORL     A,#0x3
   \                     ??Subroutine0_0:
   \   000006   F0           MOVX    @DPTR,A
   \   000007   53BABF       ANL     0xba,#0xbf
   \   00000A   22           RET
     40          
     41          //Êä³öRTCÊ±ÖÓ
     42          #pragma location="CLK_SEG"

   \                                 In segment CLK_SEG, align 1, keep-with-next
     43          void rtcclk_output(void)
   \                     rtcclk_output:
     44          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
     45          	CLKCON2 |= BIT(7);
   \   000000   43CD80       ORL     0xcd,#0x80
     46          	CLKCON3 |= BIT(6);
   \   000003   43CE40       ORL     0xce,#0x40
     47          	AIPCON8 |= BIT(1) | BIT(0); //clock output IO select P06
   \   000006                REQUIRE ?Subroutine0
   \   000006                ; // Fall through to label ?Subroutine0
     48          	P0DIR &= ~BIT(6);
     49          }
     50          
     51          //Êä³öPLL²Î¿¼Ê±ÖÓ(Èç¾§ÕñÊ±ÖÓ¡¢RCÊ±ÖÓ)
     52          #pragma location="CLK_SEG"

   \                                 In segment CLK_SEG, align 1, keep-with-next
     53          void pllrefclk_output(void)
   \                     pllrefclk_output:
     54          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
     55          	CLKCON4 |= BIT(4);          //pll test signal enable
   \   000000   43CF10       ORL     0xcf,#0x10
     56          	CLKCON2 &= ~BIT(2);         //output pll reference clock
   \   000003   53CDFB       ANL     0xcd,#0xfb
     57          	AIPCON8 |= BIT(1) | BIT(0); //clock output IO select P06
   \   000006   80..         SJMP    ?Subroutine0
     58          	P0DIR &= ~BIT(6);
     59          }
     60          
     61          /*----------------------------------------------------------------------------*/
     62          /**@brief ÏµÍ³Ê±ÖÓ³õÊ¼»¯
     63             @param ÎÞ
     64             @return ÎÞ
     65             @note ÉÏµçÄ¬ÈÏPLLÊ¹ÓÃRC10M£¬SYS=PLL=24M
     66          */
     67          /*----------------------------------------------------------------------------*/
     68          #pragma location="CLK_SEG"

   \                                 In segment CLK_SEG, align 1, keep-with-next
     69          void sysclk_set(void)
   \                     sysclk_set:
     70          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
     71          	IRTCON1 |= BIT(2);          //IRTCC POR reset system enable(VDDRTCÍ¨¹ýµç×è¶Ì½Óµ½µØ¿É¸´Î»Ð¾Æ¬)
   \   000000   43A304       ORL     0xa3,#0x4
     72          
     73          	RC_CON |= BIT(5)|BIT(4);                //trim_clk tie to 0
   \   000003   903064       MOV     DPTR,#0x3064
   \   000006   E0           MOVX    A,@DPTR
   \   000007   4430         ORL     A,#0x30
   \   000009   F0           MOVX    @DPTR,A
     74          
     75          	/*
     76          	    sysclk_output();            //Êä³öÏµÍ³Ê±ÖÓ
     77          	    rtcclk_output();            //Êä³öRTCÊ±ÖÓ
     78          	    pllrefclk_output();         //Êä³öPLL²Î¿¼Ê±ÖÓ(Èç¾§ÕñÊ±ÖÓ¡¢RCÊ±ÖÓ)
     79          	*/
     80          
     81          #if (CRY_PIN_NUM == CRY_1PIN)
     82          	CLKCON3 |= BIT(5);          //xosc select one pin mode
     83          #endif
     84          #ifdef UART_DEBUG
     85          	DPCON &= 0x3F;
   \   00000A   53863F       ANL     0x86,#0x3f
   \   00000D   E586         MOV     A,0x86
     86          	DPCON |= BIT(6);
   \   00000F   438640       ORL     0x86,#0x40
     87          #ifdef AX207X_TAG
     88          	select_irom1();
   \   000012   C08B         push 0x8b
   \   000014   538BEE       anl 0x8b, #0xee
     89          	Pllset();
   \   000017                ; Setup parameters for call to function Pllset
   \   000017   12....       LCALL   Pllset
     90          	restore_mem();
   \   00001A   D08B         pop 0x8b
     91          #endif
     92          	sys.delay_sys = 48;                         //ÉÏµçÄ¬ÈÏÊÇ24M
   \   00001C   75..30       MOV     sys,#0x30
     93          	sys.clk_mode = SYS_24M;
   \   00001F   75..00       MOV     (sys + 2),#0x0
     94          #else   //UART_DEBUG
     95          #if ((SYS_CRY == CRY_32K) || (SYS_CRY == CRY_AUTO))
     96          	irtc_write_cmd(CFG3_WR, 0x07);              //drive sel ¼Ó¿ìxoscÆðÕñÊ±¼äµ«»áÔö¼Ó¹¦ºÄ ÆðÕñÍêºóÒª°ÑÇý¶¯¸Ä»ØÄ¬ÈÏÖµÒÔ½ÚÊ¡¹¦ºÄ
     97          	CLKCON |= BIT(7)|BIT(4);                    //enable xosc32k, rc2m
     98          	CLKCON &= ~(BIT(6)|BIT(2));                 //disable xosc12m, xosc select 32k
     99          #elif ((SYS_CRY == CRY_24M) || (SYS_CRY == CRY_12M) || (SYS_CRY == CRY_4M))
    100          	CLKCON |= BIT(6)|BIT(4)|BIT(2);             //enable xosc12m, rc2m, xosc select 12m
    101          	CLKCON &= ~BIT(7);                          //disable xosc32k
    102          #endif
    103          	sys.delay_sys = 5;                          //ÉÏµçÄ¬ÈÏÊÇ512k
    104          
    105          #if SRAM_DEBUG
    106          	pll_clk_rc10m_sram(PLL_INTL,PLL_FRACL,PLL_FRACH);
    107          #else
    108          	pll_clk_rc10m();
    109          #endif
    110          
    111          	sys_clk_pll(1);
    112          	sys.delay_sys = 48;
    113          	sys.clk_mode = SYS_24M;
    114          #endif
    115          
    116          #if TASK_LOWPOWER_EN
    117          	sys_ctl.rc2m = cal_rc2m();                  //¼ÆËãrc2mÊµ¼ÊÆµÂÊ
    118          #endif
    119          }
   \   000022   22           RET
    120          
    121          /*----------------------------------------------------------------------------*/
    122          /**@brief Íâ²¿¾§Õñ³õÊ¼»¯
    123             @param ÎÞ
    124             @return ÎÞ
    125             @note ÓÐ¾§ÕñÊ±£¬ÏµÍ³Ê±ÖÓÓÉRC+PLLÇÐ»»µ½XOSC+PLL£»ÎÞ¾§ÕñÊ±£¬²»ÇÐ»»
    126          */
    127          /*----------------------------------------------------------------------------*/
    128          #pragma location="CLK_SEG"

   \                                 In segment CLK_SEG, align 1, keep-with-next
    129          void sys_pll_xosc(void)
   \                     sys_pll_xosc:
    130          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
    131          #ifndef UART_DEBUG
    132          
    133          #if (SYS_CRY == CRY_AUTO)
    134          	irtc_write_cmd(CFG3_WR, 0x04); //ÒòÎªÆðÕñÒªÒ»¶ÎÊ±¼ä ÆðÕñºóÔÚ´Ë´¦°ÑxoscµÄÇý¶¯¸Ä»ØÄ¬ÈÏÖµÒÔ½ÚÊ¡¹¦ºÄ
    135          	if(!b_sys.xosc_flag)
    136          	{
    137          		return;                    //×Ô¶¯ÅÐ¶ÏÄ£Ê½£¬ÎÞ¾§Õñ£¬²»ÇÐ»»
    138          	}
    139          	pll_clk_x32k();
    140          #elif (SYS_CRY == CRY_32K)
    141          #if (CRY_PIN_NUM == CRY_1PIN)    //µ¥½Å¾§ÕñÆðÕñÂý
    142          	if(sys_ctl.irtc_poweron)
    143          	{
    144          		delay_5ms(70);
    145          		WATCHDOG_CLR();
    146          	}
    147          #endif
    148          	irtc_write_cmd(CFG3_WR, 0x04); //ÒòÎªÆðÕñÒªÒ»¶ÎÊ±¼ä ÆðÕñºóÔÚ´Ë´¦°ÑxoscµÄÇý¶¯¸Ä»ØÄ¬ÈÏÖµÒÔ½ÚÊ¡¹¦ºÄ
    149          	pll_clk_x32k();
    150          #elif (SYS_CRY == CRY_4M)
    151          	pll_clk_x4m();
    152          #elif (SYS_CRY == CRY_12M)
    153          	pll_clk_x12m();
    154          #elif (SYS_CRY == CRY_24M)
    155          	pll_clk_x24m();
    156          #elif (SYS_CRY == CRY_RC)
    157          #else
    158          #error "ÇëÑ¡ÔñÒ»ÖÖÊ±ÖÓÔ´"
    159          #endif
    160          	sys_clk_pll(1);
    161          
    162          	CLKCON &= ~BIT(5);                  //disable rc12m
    163          #endif
    164          }
   \   000000   22           RET
    165          
    166          /*----------------------------------------------------------------------------*/
    167          /**@brief ÇÐ»»ÏµÍ³Ê±ÖÓ
    168             @param ÎÞ
    169             @return ÎÞ
    170             @note
    171          */
    172          /*----------------------------------------------------------------------------*/
    173          #pragma location="SET_SYS_CLK_SEG"

   \                                 In segment SET_SYS_CLK_SEG, align 1, keep-with-next
    174          void set_sys_clk(u8 mode)
   \                     set_sys_clk:
    175          {
   \   000000   7402         MOV     A,#0x2
   \   000002   12....       LCALL   ?FUNC_ENTER_SP
   \   000005                ; Saved register size: 5
   \   000005                ; Auto size: 0
    176          	u8 pll_v, sys_v;
    177          	if(sys.clk_mode == mode)
   \   000005   E5..         MOV     A,(sys + 2)
   \   000007   69           XRL     A,R1
   \   000008   7003         JNZ     $+5
   \   00000A   02....       LJMP    ??set_sys_clk_0
    178          	{
    179          		return;
    180          	}
    181          	sys.clk_mode = mode;
   \   00000D   89..         MOV     (sys + 2),R1
    182          #if PRINTF_EN
    183          	while((UARTCON & BIT(4)) && (UARTSTA & BIT(4)) == 0);           //µÈ´ý´®¿Ú´òÓ¡Íê±Ï
   \                     ??set_sys_clk_1:
   \   00000F   E5C4         MOV     A,0xc4
   \   000011   A2E4         MOV     C,0xE0 /* A   */.4
   \   000013   5006         JNC     ??set_sys_clk_2
   \   000015   E5C3         MOV     A,0xc3
   \   000017   A2E4         MOV     C,0xE0 /* A   */.4
   \   000019   50F4         JNC     ??set_sys_clk_1
    184          #endif
    185          
    186          	bool tmp_ea = IE_EA;
   \                     ??set_sys_clk_2:
   \   00001B   A2AF         MOV     C,0xa8.7
   \   00001D   5004         JNC     ??set_sys_clk_3
   \   00001F   D2..         SETB    ?VB.0
   \   000021   8002         SJMP    ??set_sys_clk_4
   \                     ??set_sys_clk_3:
   \   000023   C2..         CLR     ?VB.0
    187          	IE_EA = 0;
   \                     ??set_sys_clk_4:
   \   000025   C2AF         CLR     0xa8.7
    188          
    189          	switch(mode)
   \   000027   E9           MOV     A,R1
   \   000028   12....       LCALL   ?UC_SWITCH_DENSE
   \                     `?<Jumptable for set_sys_clk>_0`:
   \   00002B   00           DB        0
   \   00002C   01           DB        1
   \   00002D   ....         DW        ??set_sys_clk_5
   \   00002F   ....         DW        ??set_sys_clk_6
   \   000031   ....         DW        ??set_sys_clk_7
    190          	{
    191          #if (FM_CLOCK == USE_SD_IO_32KHZ_CLK)
    192          	case SYS_12M:
    193          		pll_v = 0;              //PLL = 48M
    194          		sys_v = 2;              //SYS = 12M
    195          		break;
    196          #endif
    197          	case SYS_24M:
    198          		pll_v = 0;              //PLL = 48M
   \                     ??set_sys_clk_6:
   \   000033   8E..         MOV     ?V0 + 0,R6
    199          		sys_v = 1;              //SYS = 24M
   \   000035   0E           INC     R6
   \   000036   8002         SJMP    ??set_sys_clk_5
    200          		break;
    201          
    202          #if WAV_SUPPORT                 //Ä¿Ç°Ö»ÓÐWAVÓÃµ½ÁË48M
    203          	case SYS_48M:
    204          		pll_v = 0;              //PLL = 48M
   \                     ??set_sys_clk_7:
   \   000038   8E..         MOV     ?V0 + 0,R6
    205          		sys_v = 0;              //SYS = 48M
    206          #ifdef AX107X_TAG
    207          		MEMCON |= BIT(7);       //otp_clk = sys_clk/2
    208          #endif
    209          		break;
    210          #endif
    211          
    212          #if TASK_LOWPOWER_EN
    213          	case SYS_RC_1M:
    214          		CLKCON |= BIT(4);                   //enable rc2m
    215          		delay_1ms(1);                       //delay >2us ????
    216          		CLKCON = (CLKCON & 0xfc) | BIT(0);  //sysclk select rc2m
    217          		CLKCON1 = (CLKCON1 & 0xf3);         //sysclk no div
    218          		CLKCON &= ~BIT(5);                  //disable rc12m
    219          		CLKCON3 &= ~(BIT(0)|BIT(4));        //disable pll, rc_sys_clk select rc2m
    220          		CLKCON2 = (CLKCON2 & 0xfc) | BIT(0);//rc_sys_clk div 4
    221          		CLKCON &= ~BIT(3);                  //mux_clk select rc_sys_clk
    222          		CLKCON = (CLKCON & 0xfc);           //sysclk select mux_clk
    223          
    224          		TMR2PRH = (u8)(sys_ctl.rc2m>>9);
    225          		TMR2PRL = (u8)(sys_ctl.rc2m>>1);
    226          		TMR2CON1 = (TMR2CON1 & 0xf8);       //¶¨Ê±Æ÷
    227          #if PRINTF_EN
    228          		UARTBAUD = sys_ctl.rc2m*10/2/1152;  //UART
    229          		UARTBAUDH = 0;
    230          #endif
    231          		sd_set_rate(0);                     //sd
    232          		IE_EA = tmp_ea;
    233          		return;
    234          #endif
    235          
    236          		/*
    237          		    case SYS_RC_2M:
    238          		        CLKCON |= BIT(4);                   //enable rc2m
    239          		        delay_1ms(1);                       //delay >2us ????
    240          		        CLKCON = (CLKCON & 0xfc) | BIT(0);  //sysclk select rc2m
    241          		        CLKCON1 = (CLKCON1 & 0xf3);         //sysclk no div
    242          		        CLKCON &= ~BIT(5);                  //disable rc12m
    243          		        CLKCON3 &= ~BIT(0);                 //disable pll
    244          
    245          		        TMR2PRH = (u8)(sys_ctl.rc2m>>8);
    246          		        TMR2PRL = (u8)(sys_ctl.rc2m);
    247          		        TMR2CON1 = (TMR2CON1 & 0xf8);       //¶¨Ê±Æ÷
    248          		#if PRINTF_EN
    249          		        UARTBAUD = sys_ctl.rc2m*10/1152;    //UART
    250          		        UARTBAUDH = 0;
    251          		#endif
    252          		        sd_set_rate(0);                     //sd
    253          		        IE_EA = tmp_ea;
    254          		        return;
    255          		*/
    256          	}
    257          
    258          	//ÉèÖÃpll
    259          	if((CLKCON3 & BIT(0)) == 0)
   \                     ??set_sys_clk_5:
   \   00003A   E5CE         MOV     A,0xce
   \   00003C   A2E0         MOV     C,0xE0 /* A   */.0
   \   00003E   4003         JC      ??set_sys_clk_8
    260          	{
    261          #if (SYS_CRY == CRY_AUTO)
    262          		if(b_sys.xosc_flag)
    263          		{
    264          			pll_clk_x32k();
    265          		}
    266          		else
    267          		{
    268          #if SRAM_DEBUG
    269          			pll_clk_rc10m_sram(PLL_INTL,PLL_FRACL,PLL_FRACH);
    270          #else
    271          			pll_clk_rc10m();
    272          #endif
    273          		}
    274          #elif (SYS_CRY == CRY_32K)
    275          		pll_clk_x32k();
   \   000040                ; Setup parameters for call to function pll_clk_x32k
   \   000040   12....       LCALL   pll_clk_x32k
    276          #elif (SYS_CRY == CRY_4M)
    277          		pll_clk_x4m();
    278          #elif (SYS_CRY == CRY_12M)
    279          		pll_clk_x12m();
    280          #elif (SYS_CRY == CRY_24M)
    281          		pll_clk_x24m();
    282          #elif (SYS_CRY == CRY_RC)
    283          #else
    284          #error "ÇëÑ¡ÔñÒ»ÖÖÊ±ÖÓÔ´"
    285          #endif
    286          	}
    287          
    288          	//ÉèÖÃÏµÍ³Ê±ÖÓ
    289          	sys_clk_pll(sys_v);
   \                     ??set_sys_clk_8:
   \   000043                ; Setup parameters for call to function sys_clk_pll
   \   000043   EE           MOV     A,R6
   \   000044   F9           MOV     R1,A
   \   000045   12....       LCALL   sys_clk_pll
    290          
    291          #ifdef AX107X_TAG
    292          #if WAV_SUPPORT     //Ä¿Ç°Ö»ÓÐWAVÓÃµ½ÁË48M
    293          	if(mode != SYS_48M)
    294          	{
    295          		MEMCON &= ~BIT(7);       //otp_clk = sys_clk
    296          	}
    297          #endif
    298          #endif
    299          
    300          	//ÉèÖÃÄ£¿éÊ±ÖÓ
    301          	sys_v += pll_v_s[pll_v & 0x03];
   \   000048   7403         MOV     A,#0x3
   \   00004A   55..         ANL     A,?V0 + 0
   \   00004C   7900         MOV     R1,#0x0
   \   00004E   24..         ADD     A,#(pll_v_s & 0xff)
   \   000050   F582         MOV     DPL,A
   \   000052   E4           CLR     A
   \   000053   34..         ADDC    A,#((pll_v_s >> 8) & 0xff)
   \   000055   F583         MOV     DPH,A
   \   000057   E4           CLR     A
   \   000058   93           MOVC    A,@A+DPTR
   \   000059   2E           ADD     A,R6
   \   00005A   FE           MOV     R6,A
    302          #if LED_7P7S_SCAN_HALF_MS
    303          	TMR2PRH = 0x00;
    304          	TMR2PRL = 0xBA;      // 0x00BAÎª0.5ms
    305          #else
    306          	TMR2PRH = 0x01;
   \   00005B   7401         MOV     A,#0x1
   \   00005D   903029       MOV     DPTR,#0x3029
   \   000060   F0           MOVX    @DPTR,A
    307          	TMR2PRL = 0x77;      // 0x0752Îª5ms, 0x177Îª1ms
   \   000061   7477         MOV     A,#0x77
   \   000063   903028       MOV     DPTR,#0x3028
   \   000066   F0           MOVX    @DPTR,A
    308          #endif
    309          	TMR1CON1 = (TMR1CON1 & 0xf8) | (7-sys_v);   //¶¨Ê±Æ÷
   \   000067   7407         MOV     A,#0x7
   \   000069   C3           CLR     C
   \   00006A   9E           SUBB    A,R6
   \   00006B   FA           MOV     R2,A
   \   00006C   74F8         MOV     A,#-0x8
   \   00006E   55E2         ANL     A,0xe2
   \   000070   4A           ORL     A,R2
   \   000071   F5E2         MOV     0xe2,A
    310          	TMR2CON1 = (TMR2CON1 & 0xf8) | (7-sys_v);   //¶¨Ê±Æ÷
   \   000073   74F8         MOV     A,#-0x8
   \   000075   55C2         ANL     A,0xc2
   \   000077   4A           ORL     A,R2
   \   000078   F5C2         MOV     0xc2,A
    311          #if PRINTF_EN
    312          	UARTBAUD = 0x33 >> sys_v;                   //UART
   \   00007A   75..33       MOV     ?V0 + 0,#0x33
   \   00007D   89..         MOV     ?V0 + 1,R1
   \   00007F   EE           MOV     A,R6
   \   000080   78..         MOV     R0,#?V0 + 0
   \   000082   12....       LCALL   ?SS_SHR
   \   000085   E5..         MOV     A,?V0 + 0
   \   000087   F5C5         MOV     0xc5,A
    313          	UARTBAUDH = 0x70;
   \   000089   75C670       MOV     0xc6,#0x70
    314          #endif
    315          	sd_set_rate(0);                             //sd, ÏµÍ³ÔÚ12MÊ±ÅÜ6M£¬ÆäÓàÎª12M
   \   00008C                ; Setup parameters for call to function sd_set_rate
   \   00008C   12....       LCALL   sd_set_rate
    316          
    317          	IE_EA = tmp_ea;
   \   00008F   A2..         MOV     C,?VB.0
   \   000091   92AF         MOV     0xa8.7,C
    318          }
   \                     ??set_sys_clk_0:
   \   000093   7F02         MOV     R7,#0x2
   \   000095   02....       LJMP    ?FUNC_LEAVE_SP
    319          
    320          //»ñÈ¡ÏµÍ³Ê±ÖÓ
    321          #pragma location="CLK_SEG"

   \                                 In segment CLK_SEG, align 1, keep-with-next
    322          u8 get_sys_clk(void)
   \                     get_sys_clk:
    323          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
    324          	return sys.clk_mode;
   \   000000   A9..         MOV     R1,(sys + 2)
   \   000002   22           RET
    325          }

   \                                 In segment SFR_AN, at 0xa8
   \   union <unnamed> volatile __sfr _A_IE0
   \                     _A_IE0:
   \   000000                DS 1

   Maximum stack usage in bytes:

     Function          EXT_STACK PSTACK XSTACK
     --------          --------- ------ ------
     get_sys_clk              0      0      0
     pllrefclk_output         0      0      0
     rtcclk_output            0      0      0
     set_sys_clk              5      0      0
       -> pll_clk_x32k       10      0      0
       -> sys_clk_pll        10      0      0
       -> sd_set_rate        10      0      0
     sys_pll_xosc             0      0      0
     sysclk_output            0      0      0
     sysclk_set               0      0      0
       -> Pllset              0      0      0


   Segment part sizes:

     Function/Label   Bytes
     --------------   -----
     DPCON               1
     IRTCON1             1
     P0DIR               1
     TMR2CON1            1
     UARTSTA             1
     UARTCON             1
     UARTBAUD            1
     UARTBAUDH           1
     CLKCON2             1
     CLKCON3             1
     CLKCON4             1
     TMR1CON1            1
     pll_v_s             4
     sysclk_output      18
     ?Subroutine0       11
     rtcclk_output       6
     pllrefclk_output    8
     sysclk_set         35
     sys_pll_xosc        1
     set_sys_clk       152
     get_sys_clk         3
     _A_IE0              1

 
  82 bytes in segment CLK_SEG
   4 bytes in segment CODE_C
 152 bytes in segment SET_SYS_CLK_SEG
  13 bytes in segment SFR_AN
 
 238 bytes of CODE memory
   0 bytes of DATA memory (+ 13 bytes shared)

Errors: none
Warnings: none
